{% extends "base.html" %}

{% block title %}–û–±–∑–æ—Ä - WB Manager{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <p class="page-eyebrow">–ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω WB Manager</p>
        <h1 class="page-title">–û–±–∑–æ—Ä –ü–í–ó</h1>
    </div>
    <p class="page-helper">–¶–∏—Ñ—Ä—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ ¬∑ –∫–ª–∏–∫–∞–π—Ç–µ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º –¥–ª—è –¥–µ—Ç–∞–ª–µ–π</p>
</div>

<!-- –û–±—â–∏–π –ø–æ–∏—Å–∫ -->
<div class="search-primary-card">
    <div class="search-card-header">
        <div>
            <p class="search-label">–û–±—â–∏–π –ø–æ–∏—Å–∫</p>
            <p class="search-description">–ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω–æ –∏—â–µ—Ç –ø–æ —Ç–æ–≤–∞—Ä–∞–º, –∫–ª–∏–µ–Ω—Ç–∞–º, –∑–∞–∫–∞–∑–∞–º –∏ –∏—Å—Ç–æ—Ä–∏–∏</p>
        </div>
    </div>
    <div class="search-card-body">
        <div class="search-container">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
            <input type="text" id="search-input" class="search-input" 
                   placeholder="–ù–∞—á–Ω–∏—Ç–µ –ø–µ—á–∞—Ç–∞—Ç—å –∑–∞–ø—Ä–æ—Å...">
        </div>
    </div>
</div>

<!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–∏—Å–∫–∏ -->
<div class="search-board">
    <div class="search-card">
        <div class="search-card-header">
            <p class="search-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</p>
            <p class="search-description">–£–≤–∏–¥–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å –±—Ä–µ–Ω–¥–æ–º –∏ –¥–æ—Å—Ç—É–ø–Ω–æ–π —è—á–µ–π–∫–æ–π</p>
        </div>
        <div class="search-card-body">
            <div class="search-field">
                <input type="text" id="search-name-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –∫–µ–¥—ã, Hugo Boss...">
                <button type="button" class="search-btn" data-search-action="name">–ò—Å–∫–∞—Ç—å</button>
            </div>
            <div id="search-name-results" class="search-inline-results" data-empty="–ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –Ω–∏–∂–µ"></div>
        </div>
    </div>
    <div class="search-card">
        <div class="search-card-header">
            <p class="search-label">–ü–æ –®–ö —Ç–æ–≤–∞—Ä–∞</p>
            <p class="search-description">–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —à—Ç—Ä–∏—Ö–∫–æ–¥ –≤—Ä—É—á–Ω—É—é</p>
        </div>
        <div class="search-card-body">
            <div class="search-field">
                <input type="text" id="search-barcode-input" placeholder="0000 0000 0000">
                <button type="button" class="search-btn" data-search-action="barcode">–ù–∞–π—Ç–∏</button>
            </div>
            <div id="search-barcode-results" class="search-inline-results" data-empty="–û–∂–∏–¥–∞–µ–º —Å–∫–∞–Ω..."></div>
        </div>
    </div>
    <div class="search-card">
        <div class="search-card-header">
            <p class="search-label">–ü–æ –∫–ª–∏–µ–Ω—Ç–∞–º</p>
            <p class="search-description">–ò–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ SID ¬∑ –æ—Ç–∫—Ä–æ–µ–º –ø—Ä–æ—Ñ–∏–ª—å</p>
        </div>
        <div class="search-card-body">
            <div class="search-field">
                <input type="text" id="search-buyers-input" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω, –∏–º—è, SID...">
                <button type="button" class="search-btn" data-search-action="buyers">–û—Ç–∫—Ä—ã—Ç—å</button>
            </div>
            <div id="search-buyers-results" class="search-inline-results" data-empty="–í—ã–±–µ—Ä–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞"></div>
        </div>
    </div>
    <div class="search-card">
        <div class="search-card-header">
            <p class="search-label">–ü–æ –∑–∞–∫–∞–∑–∞–º</p>
            <p class="search-description">–ù–∞—Ö–æ–¥–∏–º –≤—ã–¥–∞—á–∏ –ø–æ –®–ö —Ç–æ–≤–∞—Ä–∞</p>
        </div>
        <div class="search-card-body">
            <div class="search-field">
                <input type="text" id="search-orders-input" placeholder="–®–ö –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ –≤—ã–¥–∞—á–∏">
                <button type="button" class="search-btn" data-search-action="orders">–ò—Å—Ç–æ—Ä–∏—è</button>
            </div>
            <div id="search-orders-results" class="search-inline-results" data-empty="–ó–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–¥–∞—á–∏"></div>
        </div>
    </div>
</div>

<!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
<div class="module-actions-grid">
    <a href="/voiceover" class="module-action voiceover">
        <div class="module-icon">üéôÔ∏è</div>
        <div>
            <div class="module-title">–û–∑–≤—É—á–∫–∞</div>
            <p class="module-text">–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–Ω–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π –æ–∑–≤—É—á–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã WB PVZ</p>
        </div>
    </a>
    <a href="/bot" class="module-action telegram">
        <div class="module-icon">ü§ñ</div>
        <div>
            <div class="module-title">Telegram-–±–æ—Ç</div>
            <p class="module-text">–ü–æ–ª—É—á–∞–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–æ—Å—Ç–∞–≤–∫–∞—Ö –∏ –±—ã—Å—Ç—Ä–æ —Å–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Ñ–æ—Ç–æ –Ω–∞ –ü–ö</p>
        </div>
    </a>
    <a href="/surplus" class="module-action surplus">
        <div class="module-icon">üì¶</div>
        <div>
            <div class="module-title">–ò–∑–ª–∏—à–∫–∏</div>
            <p class="module-text">–û—á–∏—â–∞–π—Ç–µ —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤, –ø—Ä–∏–Ω—è—Ç—ã—Ö –ø–æ –æ—à–∏–±–∫–µ</p>
        </div>
    </a>
    <a href="/buyers" class="module-action buyers">
        <div class="module-icon">üë•</div>
        <div>
            <div class="module-title">–í—Å–µ –∫–ª–∏–µ–Ω—Ç—ã</div>
            <p class="module-text">–ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª–∏ –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã –≤ –æ–¥–∏–Ω –∫–ª–∏–∫</p>
        </div>
    </a>
</div>

<!-- –ï–¥–∏–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="stats-board">
    <div class="stats-board-header">
        <div>
            <p class="stats-label">–°–≤–æ–¥–Ω—ã–µ —Ü–∏—Ñ—Ä—ã</p>
            <p class="stats-description">–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å—ë, —á—Ç–æ –≤–∞–∂–Ω–æ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å</p>
        </div>
        <button type="button" class="btn btn-glass" onclick="loadStats(); loadStatusStats();">–û–±–Ω–æ–≤–∏—Ç—å</button>
    </div>
    <div class="stats-warning">‚ö†Ô∏è –≠—Ç–∏ —Ü–∏—Ñ—Ä—ã –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω—ã–µ –∏ –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π Wildberries.</div>
    <div class="stats-grid stats-grid-hero">
        <div class="stat-card purple">
            <div class="stat-value" data-stat="goods_at_pickup">-</div>
            <div class="stat-label">–¢–æ–≤–∞—Ä–æ–≤ –Ω–∞ –ü–í–ó</div>
        </div>
        <div class="stat-card blue">
            <div class="stat-value" data-stat="goods_on_way">-</div>
            <div class="stat-label">–¢–æ–≤–∞—Ä–æ–≤ –≤ –ø—É—Ç–∏</div>
        </div>
        <div class="stat-card green">
            <div class="stat-value" data-stat="total_buyers">-</div>
            <div class="stat-label">–í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
        </div>
        <div class="stat-card orange">
            <div class="stat-value" data-stat="occupied_cells">-</div>
            <div class="stat-label">–ó–∞–Ω—è—Ç–æ —è—á–µ–µ–∫</div>
        </div>
        <div class="stat-card red">
            <div class="stat-value" data-stat="surplus_count">-</div>
            <div class="stat-label">–ò–∑–ª–∏—à–∫–æ–≤</div>
        </div>
    </div>
    <div class="stats-status-block">
        <p class="stats-label">–¢–æ–≤–∞—Ä—ã –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º</p>
        <div class="stats-grid stats-grid-status" id="status-stats">
            <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º
async function loadStatusStats() {
    try {
        const stats = await API.get('/stats');
        const statusStats = stats.by_status || {};
        
        const statusLabels = {
            'GOODS_READY': { label: '–ì–æ—Ç–æ–≤ –∫ –≤—ã–¥–∞—á–µ', class: 'green' },
            'GOODS_RECIEVED': { label: '–ü–æ–ª—É—á–µ–Ω', class: 'blue' },
            'GOODS_COURIER_RECEIVED': { label: '–£ –∫—É—Ä—å–µ—Ä–∞', class: 'orange' },
            'GOODS_DECLINED': { label: '–û—Ç–∫–∞–∑', class: 'red' },
            'GOODS_ACCEPT_CLIENT_CANCELED': { label: '–û—Ç–º–µ–Ω—ë–Ω', class: 'gray' }
        };
        
        const container = document.getElementById('status-stats');
        container.innerHTML = Object.entries(statusStats)
            .filter(([status]) => statusLabels[status])
            .map(([status, count]) => {
                const { label, class: cls } = statusLabels[status];
                return `
                    <div class="stat-card ${cls}">
                        <div class="stat-value">${count}</div>
                        <div class="stat-label">${label}</div>
                    </div>
                `;
            }).join('');
    } catch (err) {
        console.error('Load status stats error:', err);
    }
}

// –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
let indexAutoRefresh = null;
function startIndexAutoRefresh() {
    if (indexAutoRefresh) clearInterval(indexAutoRefresh);
    indexAutoRefresh = setInterval(() => {
        loadStats();
        loadStatusStats();
    }, 30000);
}

document.addEventListener('DOMContentLoaded', () => {
    loadStatusStats();
    startIndexAutoRefresh();
});
</script>
{% endblock %}
